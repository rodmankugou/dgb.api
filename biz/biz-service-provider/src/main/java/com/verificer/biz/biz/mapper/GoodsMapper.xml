<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.verificer.biz.biz.mapper.GoodsMapper">
  <resultMap id="BaseResultMap" type="com.verificer.biz.biz.entity.Goods">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="category_id" jdbcType="BIGINT" property="categoryId" />
    <result column="brand_id" jdbcType="BIGINT" property="brandId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="sub_title" jdbcType="VARCHAR" property="subTitle" />
    <result column="img_list" jdbcType="VARCHAR" property="imgList" />
    <result column="key_word" jdbcType="VARCHAR" property="keyWord" />
    <result column="search_key" jdbcType="VARCHAR" property="searchKey" />
    <result column="free_shipping_flag" jdbcType="BIT" property="freeShippingFlag" />
    <result column="weight" jdbcType="DECIMAL" property="weight" />
    <result column="volume" jdbcType="DECIMAL" property="volume" />
    <result column="max_limit_count" jdbcType="DECIMAL" property="maxLimitCount" />
    <result column="min_limit_count" jdbcType="DECIMAL" property="minLimitCount" />
    <result column="unit" jdbcType="VARCHAR" property="unit" />
    <result column="sale_flag" jdbcType="TINYINT" property="saleFlag" />
    <result column="sale_time_out_flag" jdbcType="TINYINT" property="saleTimeOutFlag" />
    <result column="stop_sale_time" jdbcType="BIGINT" property="stopSaleTime" />
    <result column="detail" jdbcType="VARCHAR" property="detail" />
    <result column="create_time" jdbcType="BIGINT" property="createTime" />
    <result column="del_flag" jdbcType="BIT" property="delFlag" />
    <result column="del_time" jdbcType="BIGINT" property="delTime" />
    <result column="rubbish_flag" jdbcType="BIT" property="rubbishFlag" />
    <result column="rubbish_time" jdbcType="BIGINT" property="rubbishTime" />
    <result column="sku_flag" jdbcType="BIT" property="skuFlag" />
    <result column="pos_by_weight_flag" jdbcType="BIT" property="posByWeightFlag" />
    <result column="app_sale_flag" jdbcType="BIT" property="appSaleFlag" />
    <result column="shop_sale_flag" jdbcType="TINYINT" property="shopSaleFlag" />
    <result column="non_member_buy_flag" jdbcType="BIGINT" property="nonMemberBuyFlag" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, category_id, brand_id, name, sub_title, img_list, key_word, search_key, free_shipping_flag, 
    weight, volume, max_limit_count, min_limit_count, unit, sale_flag, sale_time_out_flag, 
    stop_sale_time, detail, create_time, del_flag, del_time, rubbish_flag, rubbish_time, 
    sku_flag, pos_by_weight_flag, app_sale_flag, shop_sale_flag, non_member_buy_flag
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from goods
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from goods
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.verificer.biz.biz.entity.Goods">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into goods (category_id, brand_id, name, 
      sub_title, img_list, key_word, 
      search_key, free_shipping_flag, weight, 
      volume, max_limit_count, min_limit_count, 
      unit, sale_flag, sale_time_out_flag, 
      stop_sale_time, detail, create_time, 
      del_flag, del_time, rubbish_flag, 
      rubbish_time, sku_flag, pos_by_weight_flag, 
      app_sale_flag, shop_sale_flag, non_member_buy_flag
      )
    values (#{categoryId,jdbcType=BIGINT}, #{brandId,jdbcType=BIGINT}, #{name,jdbcType=VARCHAR}, 
      #{subTitle,jdbcType=VARCHAR}, #{imgList,jdbcType=VARCHAR}, #{keyWord,jdbcType=VARCHAR}, 
      #{searchKey,jdbcType=VARCHAR}, #{freeShippingFlag,jdbcType=BIT}, #{weight,jdbcType=DECIMAL}, 
      #{volume,jdbcType=DECIMAL}, #{maxLimitCount,jdbcType=DECIMAL}, #{minLimitCount,jdbcType=DECIMAL}, 
      #{unit,jdbcType=VARCHAR}, #{saleFlag,jdbcType=TINYINT}, #{saleTimeOutFlag,jdbcType=TINYINT}, 
      #{stopSaleTime,jdbcType=BIGINT}, #{detail,jdbcType=VARCHAR}, #{createTime,jdbcType=BIGINT}, 
      #{delFlag,jdbcType=BIT}, #{delTime,jdbcType=BIGINT}, #{rubbishFlag,jdbcType=BIT}, 
      #{rubbishTime,jdbcType=BIGINT}, #{skuFlag,jdbcType=BIT}, #{posByWeightFlag,jdbcType=BIT}, 
      #{appSaleFlag,jdbcType=BIT}, #{shopSaleFlag,jdbcType=TINYINT}, #{nonMemberBuyFlag,jdbcType=BIGINT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.verificer.biz.biz.entity.Goods">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into goods
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="categoryId != null">
        category_id,
      </if>
      <if test="brandId != null">
        brand_id,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="subTitle != null">
        sub_title,
      </if>
      <if test="imgList != null">
        img_list,
      </if>
      <if test="keyWord != null">
        key_word,
      </if>
      <if test="searchKey != null">
        search_key,
      </if>
      <if test="freeShippingFlag != null">
        free_shipping_flag,
      </if>
      <if test="weight != null">
        weight,
      </if>
      <if test="volume != null">
        volume,
      </if>
      <if test="maxLimitCount != null">
        max_limit_count,
      </if>
      <if test="minLimitCount != null">
        min_limit_count,
      </if>
      <if test="unit != null">
        unit,
      </if>
      <if test="saleFlag != null">
        sale_flag,
      </if>
      <if test="saleTimeOutFlag != null">
        sale_time_out_flag,
      </if>
      <if test="stopSaleTime != null">
        stop_sale_time,
      </if>
      <if test="detail != null">
        detail,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="delFlag != null">
        del_flag,
      </if>
      <if test="delTime != null">
        del_time,
      </if>
      <if test="rubbishFlag != null">
        rubbish_flag,
      </if>
      <if test="rubbishTime != null">
        rubbish_time,
      </if>
      <if test="skuFlag != null">
        sku_flag,
      </if>
      <if test="posByWeightFlag != null">
        pos_by_weight_flag,
      </if>
      <if test="appSaleFlag != null">
        app_sale_flag,
      </if>
      <if test="shopSaleFlag != null">
        shop_sale_flag,
      </if>
      <if test="nonMemberBuyFlag != null">
        non_member_buy_flag,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="categoryId != null">
        #{categoryId,jdbcType=BIGINT},
      </if>
      <if test="brandId != null">
        #{brandId,jdbcType=BIGINT},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="subTitle != null">
        #{subTitle,jdbcType=VARCHAR},
      </if>
      <if test="imgList != null">
        #{imgList,jdbcType=VARCHAR},
      </if>
      <if test="keyWord != null">
        #{keyWord,jdbcType=VARCHAR},
      </if>
      <if test="searchKey != null">
        #{searchKey,jdbcType=VARCHAR},
      </if>
      <if test="freeShippingFlag != null">
        #{freeShippingFlag,jdbcType=BIT},
      </if>
      <if test="weight != null">
        #{weight,jdbcType=DECIMAL},
      </if>
      <if test="volume != null">
        #{volume,jdbcType=DECIMAL},
      </if>
      <if test="maxLimitCount != null">
        #{maxLimitCount,jdbcType=DECIMAL},
      </if>
      <if test="minLimitCount != null">
        #{minLimitCount,jdbcType=DECIMAL},
      </if>
      <if test="unit != null">
        #{unit,jdbcType=VARCHAR},
      </if>
      <if test="saleFlag != null">
        #{saleFlag,jdbcType=TINYINT},
      </if>
      <if test="saleTimeOutFlag != null">
        #{saleTimeOutFlag,jdbcType=TINYINT},
      </if>
      <if test="stopSaleTime != null">
        #{stopSaleTime,jdbcType=BIGINT},
      </if>
      <if test="detail != null">
        #{detail,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=BIGINT},
      </if>
      <if test="delFlag != null">
        #{delFlag,jdbcType=BIT},
      </if>
      <if test="delTime != null">
        #{delTime,jdbcType=BIGINT},
      </if>
      <if test="rubbishFlag != null">
        #{rubbishFlag,jdbcType=BIT},
      </if>
      <if test="rubbishTime != null">
        #{rubbishTime,jdbcType=BIGINT},
      </if>
      <if test="skuFlag != null">
        #{skuFlag,jdbcType=BIT},
      </if>
      <if test="posByWeightFlag != null">
        #{posByWeightFlag,jdbcType=BIT},
      </if>
      <if test="appSaleFlag != null">
        #{appSaleFlag,jdbcType=BIT},
      </if>
      <if test="shopSaleFlag != null">
        #{shopSaleFlag,jdbcType=TINYINT},
      </if>
      <if test="nonMemberBuyFlag != null">
        #{nonMemberBuyFlag,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.verificer.biz.biz.entity.Goods">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update goods
    <set>
      <if test="categoryId != null">
        category_id = #{categoryId,jdbcType=BIGINT},
      </if>
      <if test="brandId != null">
        brand_id = #{brandId,jdbcType=BIGINT},
      </if>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="subTitle != null">
        sub_title = #{subTitle,jdbcType=VARCHAR},
      </if>
      <if test="imgList != null">
        img_list = #{imgList,jdbcType=VARCHAR},
      </if>
      <if test="keyWord != null">
        key_word = #{keyWord,jdbcType=VARCHAR},
      </if>
      <if test="searchKey != null">
        search_key = #{searchKey,jdbcType=VARCHAR},
      </if>
      <if test="freeShippingFlag != null">
        free_shipping_flag = #{freeShippingFlag,jdbcType=BIT},
      </if>
      <if test="weight != null">
        weight = #{weight,jdbcType=DECIMAL},
      </if>
      <if test="volume != null">
        volume = #{volume,jdbcType=DECIMAL},
      </if>
      <if test="maxLimitCount != null">
        max_limit_count = #{maxLimitCount,jdbcType=DECIMAL},
      </if>
      <if test="minLimitCount != null">
        min_limit_count = #{minLimitCount,jdbcType=DECIMAL},
      </if>
      <if test="unit != null">
        unit = #{unit,jdbcType=VARCHAR},
      </if>
      <if test="saleFlag != null">
        sale_flag = #{saleFlag,jdbcType=TINYINT},
      </if>
      <if test="saleTimeOutFlag != null">
        sale_time_out_flag = #{saleTimeOutFlag,jdbcType=TINYINT},
      </if>
      <if test="stopSaleTime != null">
        stop_sale_time = #{stopSaleTime,jdbcType=BIGINT},
      </if>
      <if test="detail != null">
        detail = #{detail,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=BIGINT},
      </if>
      <if test="delFlag != null">
        del_flag = #{delFlag,jdbcType=BIT},
      </if>
      <if test="delTime != null">
        del_time = #{delTime,jdbcType=BIGINT},
      </if>
      <if test="rubbishFlag != null">
        rubbish_flag = #{rubbishFlag,jdbcType=BIT},
      </if>
      <if test="rubbishTime != null">
        rubbish_time = #{rubbishTime,jdbcType=BIGINT},
      </if>
      <if test="skuFlag != null">
        sku_flag = #{skuFlag,jdbcType=BIT},
      </if>
      <if test="posByWeightFlag != null">
        pos_by_weight_flag = #{posByWeightFlag,jdbcType=BIT},
      </if>
      <if test="appSaleFlag != null">
        app_sale_flag = #{appSaleFlag,jdbcType=BIT},
      </if>
      <if test="shopSaleFlag != null">
        shop_sale_flag = #{shopSaleFlag,jdbcType=TINYINT},
      </if>
      <if test="nonMemberBuyFlag != null">
        non_member_buy_flag = #{nonMemberBuyFlag,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.verificer.biz.biz.entity.Goods">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update goods
    set category_id = #{categoryId,jdbcType=BIGINT},
      brand_id = #{brandId,jdbcType=BIGINT},
      name = #{name,jdbcType=VARCHAR},
      sub_title = #{subTitle,jdbcType=VARCHAR},
      img_list = #{imgList,jdbcType=VARCHAR},
      key_word = #{keyWord,jdbcType=VARCHAR},
      search_key = #{searchKey,jdbcType=VARCHAR},
      free_shipping_flag = #{freeShippingFlag,jdbcType=BIT},
      weight = #{weight,jdbcType=DECIMAL},
      volume = #{volume,jdbcType=DECIMAL},
      max_limit_count = #{maxLimitCount,jdbcType=DECIMAL},
      min_limit_count = #{minLimitCount,jdbcType=DECIMAL},
      unit = #{unit,jdbcType=VARCHAR},
      sale_flag = #{saleFlag,jdbcType=TINYINT},
      sale_time_out_flag = #{saleTimeOutFlag,jdbcType=TINYINT},
      stop_sale_time = #{stopSaleTime,jdbcType=BIGINT},
      detail = #{detail,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=BIGINT},
      del_flag = #{delFlag,jdbcType=BIT},
      del_time = #{delTime,jdbcType=BIGINT},
      rubbish_flag = #{rubbishFlag,jdbcType=BIT},
      rubbish_time = #{rubbishTime,jdbcType=BIGINT},
      sku_flag = #{skuFlag,jdbcType=BIT},
      pos_by_weight_flag = #{posByWeightFlag,jdbcType=BIT},
      app_sale_flag = #{appSaleFlag,jdbcType=BIT},
      shop_sale_flag = #{shopSaleFlag,jdbcType=TINYINT},
      non_member_buy_flag = #{nonMemberBuyFlag,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
<!--以上内容自动生成-->

  <sql id="qryCond">
    <if test="rubbishFlag != null">
      and g.rubbish_flag = #{rubbishFlag}
    </if>
    <if test="saleFlag != null">
      and g.sale_flag = #{saleFlag}
    </if>
    <if test="name != null and name != '' ">
      and g.name = #{name}
    </if>
    <if test="brandId != null">
      and g.brandId = #{brandId}
    </if>
    <if test="categoryId != null">
      and g.category_id = #{categoryId}
    </if>
    <if test="sSaleCount != null">
      and (gs.pla_sale_count + gs.shop_sale_count) >= #{sSaleCount}
    </if>
    <if test="eSaleCount != null">
      and #{eSaleCount} >= (gs.pla_sale_count + gs.shop_sale_count)
    </if>
  </sql>

  <resultMap id="modelRstMap" type="com.verificer.biz.beans.vo.GoodsVo">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="category_id" jdbcType="BIGINT" property="categoryId" />
    <result column="brand_id" jdbcType="BIGINT" property="brandId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="img_list" jdbcType="VARCHAR" property="imgList" />
    <result column="key_word" jdbcType="VARCHAR" property="keyWord" />
    <result column="free_shipping_flag" jdbcType="BIT" property="freeShippingFlag" />
    <result column="weight" jdbcType="DECIMAL" property="weight" />
    <result column="volume" jdbcType="DECIMAL" property="volume" />
    <result column="max_limit_count" jdbcType="INTEGER" property="maxLimitCount" />
    <result column="min_limit_count" jdbcType="INTEGER" property="minLimitCount" />
    <result column="unit" jdbcType="VARCHAR" property="unit" />
    <result column="sale_flag" jdbcType="TINYINT" property="saleFlag" />
    <result column="sale_time_out_flag" jdbcType="TINYINT" property="saleTimeOutFlag" />
    <result column="stop_sale_time" jdbcType="BIGINT" property="stopSaleTime" />
    <result column="detail" jdbcType="VARCHAR" property="detail" />
    <result column="create_time" jdbcType="BIGINT" property="createTime" />
    <result column="rubbish_flag" jdbcType="BIT" property="rubbishFlag" />
    <result column="rubbish_time" jdbcType="BIGINT" property="rubbishTime" />
    <result column="pos_by_weight_flag" jdbcType="BIT" property="posByWeightFlag" />
    <result column="app_sale_flag" jdbcType="BIT" property="appSaleFlag" />
    <result column="shop_sale_flag" jdbcType="TINYINT" property="shopSaleFlag" />
    <result column="non_member_buy_flag" jdbcType="BIGINT" property="nonMemberBuyFlag" />
    <result column="sub_title" jdbcType="VARCHAR" property="subTitle" />

  </resultMap>

  <resultMap id="GoodsVoRstMap" extends="modelRstMap" type="com.verificer.biz.beans.vo.GoodsVo">
    <result column="pla_sale_count" jdbcType="INTEGER" property="plaSaleCount" />
    <result column="pla_stage_count" jdbcType="INTEGER" property="plaStageCount" />
    <result column="shop_sale_count" jdbcType="INTEGER" property="shopSaleCount" />
    <result column="shop_stage_count" jdbcType="INTEGER" property="shopStageCount" />
    <result column="sum_sale_count" jdbcType="INTEGER" property="sumSaleCount" />
    <result column="stage_count" jdbcType="INTEGER" property="stageCount" />

  </resultMap>

  <select id="allUnDel"  resultMap="GoodsVoRstMap">
    select
           g.*,
           gs.pla_sale_count,
           gs.pla_stage_count,
           gs.shop_sale_count,
           gs.shop_stage_count,
           (gs.pla_sale_count + gs.shop_sale_count) as sum_sale_count,
           (gs.pla_stage_count + gs.shop_stage_count) as stage_count

    from goods g join goods_sta gs on (g.id = gs.goods_id and gs.sum_sta_flag = 1)
    where g.del_flag = 0 and g.rubbish_flag = 0

  </select>

  <select id="page"  resultMap="GoodsVoRstMap">
    select
           g.*,
           gs.pla_sale_count,
           gs.pla_stage_count,
           gs.shop_sale_count,
           gs.shop_stage_count,
           (gs.pla_sale_count + gs.shop_sale_count) as sum_sale_count,
           (gs.pla_stage_count + gs.shop_stage_count) as stage_count

    from goods g join goods_sta gs on (g.id = gs.goods_id and gs.sum_sta_flag = 1)
    where g.del_flag = 0
    <include refid="qryCond"></include>
    order by sum_sale_count desc
    limit #{from},#{limit}
  </select>

  <select id="count"  resultType="int">
    select
      count(*)
    from goods g join goods_sta gs on (g.id = gs.goods_id and gs.sum_sta_flag = 1)
    where g.del_flag = 0
    <include refid="qryCond"></include>
  </select>
</mapper>
